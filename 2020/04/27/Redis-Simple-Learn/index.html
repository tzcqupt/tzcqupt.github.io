<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Redis入门学习笔记"><meta name="keywords" content="Redis"><meta name="author" content="tzcqupt"><meta name="copyright" content="tzcqupt"><title>Redis入门学习笔记 | 个人学习博客</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="个人学习博客" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#介绍"><span class="toc-number">1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#什么是NOSQL"><span class="toc-number">2.</span> <span class="toc-text">什么是NOSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NOSQL和关系型数据库比较"><span class="toc-number">2.1.</span> <span class="toc-text">NOSQL和关系型数据库比较</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#优点"><span class="toc-number">2.1.1.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#缺点"><span class="toc-number">2.1.2.</span> <span class="toc-text">缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#非关系型数据库的优势"><span class="toc-number">2.2.</span> <span class="toc-text">非关系型数据库的优势</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关系型数据库的优势"><span class="toc-number">2.3.</span> <span class="toc-text">关系型数据库的优势</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">2.4.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#主流的NOSQL产品"><span class="toc-number">3.</span> <span class="toc-text">主流的NOSQL产品</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#键值-Key-Value-存储数据库"><span class="toc-number">3.1.</span> <span class="toc-text">键值(Key-Value)存储数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#列存储数据库"><span class="toc-number">3.2.</span> <span class="toc-text">列存储数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文档型数据库"><span class="toc-number">3.3.</span> <span class="toc-text">文档型数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#图形-Graph-数据库"><span class="toc-number">3.4.</span> <span class="toc-text">图形(Graph)数据库</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#安装redis"><span class="toc-number">4.</span> <span class="toc-text">安装redis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#centos7配置redis开机启动"><span class="toc-number">4.1.</span> <span class="toc-text">centos7配置redis开机启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows设置redis开机启动"><span class="toc-number">4.2.</span> <span class="toc-text">Windows设置redis开机启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开放外网访问"><span class="toc-number">4.3.</span> <span class="toc-text">开放外网访问</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis详细介绍"><span class="toc-number">5.</span> <span class="toc-text">Redis详细介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis的应用场景"><span class="toc-number">6.</span> <span class="toc-text">Redis的应用场景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis操作"><span class="toc-number">7.</span> <span class="toc-text">Redis操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis的数据结构"><span class="toc-number">7.1.</span> <span class="toc-text">Redis的数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串类型-string"><span class="toc-number">7.1.1.</span> <span class="toc-text">字符串类型 string</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#哈希类型-hash"><span class="toc-number">7.1.2.</span> <span class="toc-text">哈希类型 hash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#列表类型-list"><span class="toc-number">7.1.3.</span> <span class="toc-text">列表类型 list</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#集合类型-set"><span class="toc-number">7.1.4.</span> <span class="toc-text">集合类型 set</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#有序集合类型-sortedset"><span class="toc-number">7.1.5.</span> <span class="toc-text">有序集合类型 sortedset</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通用命令"><span class="toc-number">7.2.</span> <span class="toc-text">通用命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#持久化"><span class="toc-number">7.3.</span> <span class="toc-text">持久化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java客户端-Jedis"><span class="toc-number">7.4.</span> <span class="toc-text">Java客户端 Jedis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用步骤"><span class="toc-number">7.4.1.</span> <span class="toc-text">使用步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Jedis操作各种Redis中的数据结构"><span class="toc-number">7.4.2.</span> <span class="toc-text">Jedis操作各种Redis中的数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#字符串类型-string-1"><span class="toc-number">7.4.2.1.</span> <span class="toc-text">字符串类型 string</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#哈希类型-hash-Map"><span class="toc-number">7.4.2.2.</span> <span class="toc-text">哈希类型 hash : Map</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#列表类型-list-LinkedList"><span class="toc-number">7.4.2.3.</span> <span class="toc-text">列表类型 list : LinkedList</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#集合类型-set-1"><span class="toc-number">7.4.2.4.</span> <span class="toc-text">集合类型 set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#有序集合类型-sortedset-1"><span class="toc-number">7.4.2.5.</span> <span class="toc-text">有序集合类型 sortedset</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jedis连接池-JedisPool"><span class="toc-number">7.4.3.</span> <span class="toc-text">jedis连接池: JedisPool</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#使用"><span class="toc-number">7.4.3.1.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#连接池工具类"><span class="toc-number">7.4.3.2.</span> <span class="toc-text">连接池工具类</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis整合"><span class="toc-number">8.</span> <span class="toc-text">Redis整合</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring整合Redis"><span class="toc-number">8.1.</span> <span class="toc-text">Spring整合Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#普通整合"><span class="toc-number">8.1.1.</span> <span class="toc-text">普通整合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#版本依赖"><span class="toc-number">8.1.1.1.</span> <span class="toc-text">版本依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置文件"><span class="toc-number">8.1.1.2.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用方式"><span class="toc-number">8.1.1.3.</span> <span class="toc-text">使用方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis的发布订阅模式"><span class="toc-number">8.1.2.</span> <span class="toc-text">Redis的发布订阅模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#xml配置"><span class="toc-number">8.1.2.1.</span> <span class="toc-text">xml配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#接受消息的类"><span class="toc-number">8.1.2.2.</span> <span class="toc-text">接受消息的类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#测试类"><span class="toc-number">8.1.2.3.</span> <span class="toc-text">测试类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring整合redis缓存"><span class="toc-number">8.1.3.</span> <span class="toc-text">Spring整合redis缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#步骤"><span class="toc-number">8.1.3.1.</span> <span class="toc-text">步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Xml配置整合"><span class="toc-number">8.1.3.2.</span> <span class="toc-text">Xml配置整合</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#application-redis-xml"><span class="toc-number">8.1.3.2.1.</span> <span class="toc-text">application_redis.xml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#application-jdbc-xml"><span class="toc-number">8.1.3.2.2.</span> <span class="toc-text">application_jdbc.xml</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Java注解配置"><span class="toc-number">8.1.3.3.</span> <span class="toc-text">Java注解配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#RedisConfig"><span class="toc-number">8.1.3.3.1.</span> <span class="toc-text">RedisConfig</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JdbcConfig"><span class="toc-number">8.1.3.3.2.</span> <span class="toc-text">JdbcConfig</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Serice层缓存注解配置"><span class="toc-number">8.1.3.4.</span> <span class="toc-text">Serice层缓存注解配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot整合Redis"><span class="toc-number">8.2.</span> <span class="toc-text">SpringBoot整合Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#普通整合-1"><span class="toc-number">8.2.1.</span> <span class="toc-text">普通整合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#依赖配置"><span class="toc-number">8.2.1.1.</span> <span class="toc-text">依赖配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#测试类-1"><span class="toc-number">8.2.1.2.</span> <span class="toc-text">测试类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis事务"><span class="toc-number">8.2.2.</span> <span class="toc-text">Redis事务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#测试代码"><span class="toc-number">8.2.2.1.</span> <span class="toc-text">测试代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis发布订阅"><span class="toc-number">8.2.3.</span> <span class="toc-text">Redis发布订阅</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Java代码配置"><span class="toc-number">8.2.3.1.</span> <span class="toc-text">Java代码配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#测试代码-1"><span class="toc-number">8.2.3.2.</span> <span class="toc-text">测试代码</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://portrait.gitee.com/uploads/avatars/user/762/2287861_tzcqupt_1588209320.png"></div><div class="author-info__name text-center">tzcqupt</div><div class="author-info__description text-center">一个努力的Java程序员小白</div><div class="follow-button"><a href="https://gitee.com/tzcqupt" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">27</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">24</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">19</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">个人学习博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">Redis入门学习笔记</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-04-27</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">7.2k</span><span class="post-meta__separator">|</span><span>阅读时长: 31 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p> Redis是一款高性能的NOSQL系列的非关系型数据库。</p>
<h1 id="什么是NOSQL"><a href="#什么是NOSQL" class="headerlink" title="什么是NOSQL"></a>什么是NOSQL</h1><p>NoSQL(NoSQL = Not Only SQL),意即“不仅仅是SQL”,是一项全新的数据库理念,泛指非关系型的数据库。</p>
<h2 id="NOSQL和关系型数据库比较"><a href="#NOSQL和关系型数据库比较" class="headerlink" title="NOSQL和关系型数据库比较"></a>NOSQL和关系型数据库比较</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol>
<li>成本:nosql数据库简单易部署,基本都是开源软件,不需要像使用oracle那样花费大量成本购买使用,相比关系型数据库价格便宜。</li>
<li>查询速度:nosql数据库将数据存储于缓存之中,关系型数据库将数据存储在硬盘中,自然查询速度远不及nosql数据库。</li>
<li>存储数据的格式:nosql的存储格式是key,value形式、文档形式、图片形式等等,所以可以存储基础类型以及对象或者是集合等各种格式,而数据库则只支持基础类型。</li>
<li>扩展性:关系型数据库有类似join这样的多表查询机制的限制导致扩展很艰难。  </li>
</ol>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>维护的工具和资料有限,因为nosql是属于新的技术,不能和关系型数据库10几年的技术同日而语。</li>
<li>不提供对sql的支持,如果不支持sql这样的工业标准,将产生一定用户的学习和使用成本。</li>
<li>不提供关系型数据库对事务的处理。</li>
</ol>
<h2 id="非关系型数据库的优势"><a href="#非关系型数据库的优势" class="headerlink" title="非关系型数据库的优势"></a>非关系型数据库的优势</h2><ol>
<li>性能NOSQL是基于键值对的,可以想象成表中的主键和值的对应关系,而且不需要经过SQL层的解析,所以性能非常高。</li>
<li>可扩展性同样也是因为基于键值对,数据之间没有耦合性,所以非常容易水平扩展。</li>
</ol>
<h2 id="关系型数据库的优势"><a href="#关系型数据库的优势" class="headerlink" title="关系型数据库的优势"></a>关系型数据库的优势</h2><ol>
<li>复杂查询可以用SQL语句方便的在一个表以及多个表之间做非常复杂的数据查询。</li>
<li>事务支持使得对于安全性能很高的数据访问要求得以实现。对于这两类数据库,对方的优势就是自己的弱势,反之亦然。</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>关系型数据库与NoSQL数据库并非对立而是互补的关系,即通常情况下使用关系型数据库,在适合使用NoSQL的时候使用NoSQL数据库,让NoSQL数据库对关系型数据库的不足进行弥补。<br>一般会将数据存储在关系型数据库中,在nosql数据库中备份存储关系型数据库的数据</p>
<h1 id="主流的NOSQL产品"><a href="#主流的NOSQL产品" class="headerlink" title="主流的NOSQL产品"></a>主流的NOSQL产品</h1><h2 id="键值-Key-Value-存储数据库"><a href="#键值-Key-Value-存储数据库" class="headerlink" title="键值(Key-Value)存储数据库"></a>键值(Key-Value)存储数据库</h2><ul>
<li>相关产品: Tokyo Cabinet/Tyrant、Redis、Voldemort、Berkeley DB</li>
<li>典型应用: 内容缓存,主要用于处理大量数据的高访问负载。 </li>
<li>数据模型: 一系列键值对</li>
<li>优势: 快速查询</li>
<li>劣势: 存储的数据缺少结构化</li>
</ul>
<h2 id="列存储数据库"><a href="#列存储数据库" class="headerlink" title="列存储数据库"></a>列存储数据库</h2><ul>
<li>相关产品:Cassandra, HBase, Riak</li>
<li>典型应用:分布式的文件系统</li>
<li>数据模型:以列簇式存储,将同一列数据存在一起</li>
<li>优势:查找速度快,可扩展性强,更容易进行分布式扩展</li>
<li>劣势:功能相对局限</li>
</ul>
<h2 id="文档型数据库"><a href="#文档型数据库" class="headerlink" title="文档型数据库"></a>文档型数据库</h2><ul>
<li>相关产品:CouchDB、MongoDB</li>
<li>典型应用:Web应用(与Key-Value类似,Value是结构化的)</li>
<li>数据模型: 一系列键值对</li>
<li>优势:数据结构要求不严格</li>
<li>劣势: 查询性能不高,而且缺乏统一的查询语法</li>
</ul>
<h2 id="图形-Graph-数据库"><a href="#图形-Graph-数据库" class="headerlink" title="图形(Graph)数据库"></a>图形(Graph)数据库</h2><ul>
<li>相关数据库:Neo4J、InfoGrid、Infinite Graph</li>
<li>典型应用:社交网络</li>
<li>数据模型:图结构</li>
<li>优势:利用图结构相关算法。</li>
<li>劣势:需要对整个图做计算才能得出结果,不容易做分布式的集群方案。</li>
</ul>
<h1 id="安装redis"><a href="#安装redis" class="headerlink" title="安装redis"></a>安装redis</h1><h2 id="centos7配置redis开机启动"><a href="#centos7配置redis开机启动" class="headerlink" title="centos7配置redis开机启动"></a>centos7配置redis开机启动</h2><ol>
<li><p>执行<code>vim /etc/systemd/system/redis.service</code>,写入下面代码</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    [Unit]</span><br><span class="line">Description=redis-server</span><br><span class="line">    After=network.target</span><br><span class="line"></span><br><span class="line">    [Service]</span><br><span class="line">    Type=forking</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/bin/redis-server /usr/<span class="built_in">local</span>/bin/redis.conf</span><br><span class="line">    PrivateTmp=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    [Install]</span><br><span class="line">    WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试命令</p>
<ul>
<li>先关闭redis-server<br><code>systemctl stop redis.service</code>  </li>
<li>开启redis-server<br>如果服务是开启状态,使用此命令会启动失败。<br><code>systemctl start redis.service</code></li>
</ul>
</li>
<li><p>设置开机启动<br> <code>systemctl enable redis.service</code></p>
<blockquote>
<p>cat /etc/centos-release查看centos版本</p>
</blockquote>
</li>
</ol>
<h2 id="Windows设置redis开机启动"><a href="#Windows设置redis开机启动" class="headerlink" title="Windows设置redis开机启动"></a>Windows设置redis开机启动</h2><ol>
<li>修改redis.windows.conf配置文件,限制内存,防止偶尔闪退,加上<code>maxmemory 209715200</code></li>
<li>在安装redis的路径下执行<code>redis-server --service-install redis.windows.conf</code></li>
<li>redis-server –service-start启动redis</li>
<li>在计算机的管理==&gt;服务里面查看redis设置为自动启动</li>
</ol>
<h2 id="开放外网访问"><a href="#开放外网访问" class="headerlink" title="开放外网访问"></a>开放外网访问</h2><p>打开<code>redis.conf</code>文件在<code>NETWORK</code>部分修改 注释掉<code>bind 127.0.0.1</code>可以使所有的ip访问redis</p>
<p>修改 <code>protected-mode</code>，值改为<code>no</code></p>
<h1 id="Redis详细介绍"><a href="#Redis详细介绍" class="headerlink" title="Redis详细介绍"></a>Redis详细介绍</h1><p>Redis是用C语言开发的一个开源的高性能键值对(key-value)数据库,Redis通过提供多种键值数据类型来适应不同场景下的存储需求,目前为止Redis支持的键值数据类型如下:</p>
<ol>
<li>字符串类型 <code>string</code>==&gt;<code>Map&lt;String,String&gt;</code></li>
<li>哈希类型 <code>hash</code>==&gt;<code>Map&lt;String,Map&lt;String,String&gt;&gt;</code></li>
<li>列表类型 <code>list</code>==&gt;<code>Map&lt;String,List&lt;String&gt;&gt;</code></li>
<li>集合类型 <code>set</code>==&gt;<code>Map&lt;String,Set&lt;String&gt;&gt;</code></li>
<li>有序集合类型 <code>sortedset</code>==&gt;可排序的<code>set</code></li>
</ol>
<h1 id="Redis的应用场景"><a href="#Redis的应用场景" class="headerlink" title="Redis的应用场景"></a>Redis的应用场景</h1><ul>
<li>缓存(数据查询、短连接、新闻内容、商品内容等等)</li>
<li>聊天室的在线好友列表</li>
<li>任务队列。(秒杀、抢购、12306等等)</li>
<li>应用排行榜</li>
<li>网站访问统计</li>
<li>数据过期处理(可以精确到毫秒)</li>
<li>分布式集群架构中的<code>session</code>分离        </li>
</ul>
<h1 id="Redis操作"><a href="#Redis操作" class="headerlink" title="Redis操作"></a>Redis操作</h1><h2 id="Redis的数据结构"><a href="#Redis的数据结构" class="headerlink" title="Redis的数据结构"></a>Redis的数据结构</h2><p>Redis存储的是:key,value格式的数据,其中key都是字符串,value有5种不同的数据结构</p>
<ol>
<li>字符串类型 <code>string</code></li>
<li>哈希类型 <code>hash</code> : <code>Map</code>格式  </li>
<li>列表类型 <code>list</code> : <code>Linkedlist</code>格式。支持重复元素</li>
<li>集合类型 <code>set</code>  : 不允许重复元素</li>
<li>有序集合类型 <code>sortedset</code>:不允许重复元素,且元素有顺序    </li>
</ol>
<h3 id="字符串类型-string"><a href="#字符串类型-string" class="headerlink" title="字符串类型 string"></a>字符串类型 <code>string</code></h3><ol>
<li>存储  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> key value </span><br><span class="line"><span class="built_in">set</span> username zhangsan</span><br></pre></td></tr></table></figure></li>
<li>获取<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">get key</span><br><span class="line">get username  </span><br><span class="line"><span class="string">"zhangsan"</span></span><br></pre></td></tr></table></figure></li>
<li>删除<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">del key</span><br><span class="line">del age</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="哈希类型-hash"><a href="#哈希类型-hash" class="headerlink" title="哈希类型 hash"></a>哈希类型 <code>hash</code></h3><ol>
<li><p>存储 </p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hset key field value</span><br><span class="line">hset myhash username lisi </span><br><span class="line">  	(<span class="built_in">integer</span>) 1  </span><br><span class="line">hset myhash password 123 </span><br><span class="line">  	(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure></li>
<li><p>获取</p>
<ul>
<li><code>hget key field</code>: 获取指定的<code>field</code>对应的值<br><code>hget myhash username</code><br><code>&quot;lisi&quot;</code></li>
<li><code>hgetall key</code>:获取所有的<code>field</code>和<code>value</code><br><code>hgetall myhash</code></li>
</ul>
</li>
<li><p>删除 </p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hdel key field   </span><br><span class="line">hdel myhash username </span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>


</li>
</ol>
<h3 id="列表类型-list"><a href="#列表类型-list" class="headerlink" title="列表类型 list"></a>列表类型 <code>list</code></h3><p>可以添加一个元素到列表的头部(左边)或者尾部(右边)</p>
<ol>
<li><p>添加</p>
<ol>
<li><p><code>lpush key value</code>: 将元素加入列表左表        </p>
</li>
<li><p><code>rpush key value</code>:将元素加入列表右边    </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lpush myList a</span><br><span class="line">(integer) 1</span><br><span class="line">lpush myList b</span><br><span class="line">(integer) 2</span><br><span class="line"> rpush myList c</span><br><span class="line">(integer) 3</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>获取</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lrange key start end :范围获取  </span><br><span class="line">lrange myList 0 -1 :表示获取所有的</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除</p>
<ul>
<li><code>lpop key</code>: 删除列表最左边的元素,并将元素返回</li>
<li><code>rpop key</code>: 删除列表最右边的元素,并将元素返回</li>
</ul>
</li>
</ol>
<h3 id="集合类型-set"><a href="#集合类型-set" class="headerlink" title="集合类型 set"></a>集合类型 <code>set</code></h3><p> 不允许重复元素</p>
<ol>
<li><p>存储:<code>sadd key value</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd myset a</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd myset a</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取:<code>smembers key</code>:获取<code>set</code>集合中所有元素</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; smembers myset</span><br><span class="line">1) "a"</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除:<code>srem key value</code>:删除<code>set</code>集合中的某个元素    </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; srem myset a</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="有序集合类型-sortedset"><a href="#有序集合类型-sortedset" class="headerlink" title="有序集合类型 sortedset"></a>有序集合类型 <code>sortedset</code></h3><p>不允许重复元素,且元素有顺序.每个元素都会关联一个double类型的分数。Redis正是通过分数来为集合中的成员进行从小到大的排序。</p>
<ol>
<li><p>存储:<code>zadd key score value</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd mysort 60 zhangsan</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd mysort 500 lisi</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd mysort 80 wangwu</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取:<code>zrange key start end [withscores]</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrange mysort 0 -1</span><br><span class="line">1) "lisi"</span><br><span class="line">2) "zhangsan"</span><br><span class="line">3) "wangwu"</span><br><span class="line">   </span><br><span class="line">127.0.0.1:6379&gt; zrange mysort 0 -1 withscores</span><br><span class="line">1) "zhangsan"</span><br><span class="line">2) "60"</span><br><span class="line">3) "wangwu"</span><br><span class="line">4) "80"</span><br><span class="line">5) "lisi"</span><br><span class="line">6) "500"</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除:<code>zrem key value</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrem mysort lisi</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="通用命令"><a href="#通用命令" class="headerlink" title="通用命令"></a>通用命令</h2><ol>
<li><code>keys *</code>: 查询所有的键</li>
<li><code>type key</code> : 获取键对应的value的类型</li>
<li><code>del key</code>:删除指定的key value</li>
</ol>
<h2 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h2><ol>
<li><p>Redis是一个内存数据库,当Redis服务器重启,获取电脑重启,数据会丢失,我们可以将Redis内存中的数据持久化保存到硬盘的文件中。</p>
</li>
<li><p>Redis持久化机制:</p>
<ol>
<li><p><code>RDB</code>:默认方式,不需要进行配置,默认就使用这种机制<br>在一定的间隔时间中,检测key的变化情况,然后持久化数据</p>
<ol>
<li><p>编辑<code>Redis.windwos.conf</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   after 900 sec (15 min) if at least 1 key changed</span></span><br><span class="line">save 900 1</span><br><span class="line"><span class="comment">#   after 300 sec (5 min) if at least 10 keys changed</span></span><br><span class="line">save 300 10</span><br><span class="line"><span class="comment">#   after 60 sec if at least 10000 keys changed</span></span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新启动Redis服务器,并指定配置文件名称<br><code>D:\JavaWeb2019\Redis\windows-64\Redis-2.8.9&gt;Redis-server.exe Redis.windows.conf</code>                </p>
</li>
</ol>
</li>
<li><p>AOF:日志记录的方式,可以记录每一条命令的操作。可以每一次命令操作后,持久化数据<br>编辑<code>Redis.windwos.conf</code>文件  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">appendonly no(关闭aof) --&gt; appendonly yes (开启aof)	</span><br><span class="line"><span class="comment"># appendfsync always : 每一次操作都进行持久化</span></span><br><span class="line">appendfsync everysec : 每隔一秒进行一次持久化</span><br><span class="line"><span class="comment"># appendfsync no	 : 不进行持久化</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ol>
<h2 id="Java客户端-Jedis"><a href="#Java客户端-Jedis" class="headerlink" title="Java客户端 Jedis"></a>Java客户端 Jedis</h2><p> 一款java操作Redis数据库的工具.</p>
<h3 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h3><ol>
<li>下载jedis的jar包</li>
<li>使用</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 获取连接</span></span><br><span class="line">  	Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"localhost"</span>,<span class="number">6379</span>);</span><br><span class="line"> 	<span class="comment">//2. 操作</span></span><br><span class="line">   jedis.set(<span class="string">"username"</span>,<span class="string">"zhangsan"</span>);</span><br><span class="line">  	<span class="comment">//3. 关闭连接</span></span><br><span class="line">  	jedis.close();</span><br></pre></td></tr></table></figure>

<h3 id="Jedis操作各种Redis中的数据结构"><a href="#Jedis操作各种Redis中的数据结构" class="headerlink" title="Jedis操作各种Redis中的数据结构"></a>Jedis操作各种Redis中的数据结构</h3><h4 id="字符串类型-string-1"><a href="#字符串类型-string-1" class="headerlink" title="字符串类型 string"></a>字符串类型 <code>string</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//set</span></span><br><span class="line"><span class="comment">//get</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//1. 获取连接</span></span><br><span class="line">    Jedis jedis = <span class="keyword">new</span> Jedis();<span class="comment">//如果使用空参构造,默认值 "localhost",6379端口</span></span><br><span class="line">    <span class="comment">//2. 操作</span></span><br><span class="line">    <span class="comment">//存储</span></span><br><span class="line">    jedis.set(<span class="string">"username"</span>,<span class="string">"zhangsan"</span>);</span><br><span class="line">    <span class="comment">//获取</span></span><br><span class="line">    String username = jedis.get(<span class="string">"username"</span>);</span><br><span class="line">    System.out.println(username);</span><br><span class="line">    <span class="comment">//可以使用setex()方法存储可以指定过期时间的 key value</span></span><br><span class="line">    jedis.setex(<span class="string">"activecode"</span>,<span class="number">20</span>,<span class="string">"hehe"</span>);<span class="comment">//将activecode:hehe键值对存入Redis,并且20秒后自动删除该键值对</span></span><br><span class="line">    <span class="comment">//3. 关闭连接</span></span><br><span class="line">    jedis.close();</span><br></pre></td></tr></table></figure>

<h4 id="哈希类型-hash-Map"><a href="#哈希类型-hash-Map" class="headerlink" title="哈希类型 hash : Map"></a>哈希类型 <code>hash</code> : <code>Map</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//hset</span></span><br><span class="line"><span class="comment">//hget</span></span><br><span class="line"><span class="comment">//hgetAll</span></span><br><span class="line"><span class="comment">//1. 获取连接</span></span><br><span class="line">    Jedis jedis = <span class="keyword">new</span> Jedis();<span class="comment">//如果使用空参构造,默认值 "localhost",6379端口</span></span><br><span class="line">    <span class="comment">//2. 操作</span></span><br><span class="line">    <span class="comment">// 存储hash</span></span><br><span class="line">    jedis.hset(<span class="string">"user"</span>,<span class="string">"name"</span>,<span class="string">"lisi"</span>);</span><br><span class="line">    jedis.hset(<span class="string">"user"</span>,<span class="string">"age"</span>,<span class="string">"23"</span>);</span><br><span class="line">    jedis.hset(<span class="string">"user"</span>,<span class="string">"gender"</span>,<span class="string">"female"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取hash</span></span><br><span class="line">    String name = jedis.hget(<span class="string">"user"</span>, <span class="string">"name"</span>);</span><br><span class="line">    System.out.println(name);</span><br><span class="line">	  <span class="comment">// 获取hash的所有map中的数据</span></span><br><span class="line">	 Map&lt;String, String&gt; user = jedis.hgetAll(<span class="string">"user"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// keyset</span></span><br><span class="line">    Set&lt;String&gt; keySet = user.keySet();</span><br><span class="line">    <span class="keyword">for</span> (String key : keySet) &#123;</span><br><span class="line">        <span class="comment">//获取value</span></span><br><span class="line">        String value = user.get(key);</span><br><span class="line">        System.out.println(key + <span class="string">":"</span> + value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. 关闭连接</span></span><br><span class="line">    jedis.close();</span><br></pre></td></tr></table></figure>

<h4 id="列表类型-list-LinkedList"><a href="#列表类型-list-LinkedList" class="headerlink" title="列表类型 list : LinkedList"></a>列表类型 <code>list</code> : <code>LinkedList</code></h4><p>支持重复元素</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lpush / rpush</span></span><br><span class="line"><span class="comment">//lpop / rpop</span></span><br><span class="line"><span class="comment">//lrange start end : 范围获取</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//1. 获取连接</span></span><br><span class="line">    Jedis jedis = <span class="keyword">new</span> Jedis();<span class="comment">//如果使用空参构造,默认值 "localhost",6379端口</span></span><br><span class="line">    <span class="comment">//2. 操作</span></span><br><span class="line">    <span class="comment">// list 存储</span></span><br><span class="line">    jedis.lpush(<span class="string">"mylist"</span>,<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>);<span class="comment">//从左边存</span></span><br><span class="line">    jedis.rpush(<span class="string">"mylist"</span>,<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>);<span class="comment">//从右边存</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// list 范围获取</span></span><br><span class="line">    List&lt;String&gt; mylist = jedis.lrange(<span class="string">"mylist"</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">    System.out.println(mylist);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// list 弹出</span></span><br><span class="line">    String element1 = jedis.lpop(<span class="string">"mylist"</span>);<span class="comment">//c</span></span><br><span class="line">    System.out.println(element1);</span><br><span class="line">  </span><br><span class="line">    String element2 = jedis.rpop(<span class="string">"mylist"</span>);<span class="comment">//c</span></span><br><span class="line">    System.out.println(element2);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// list 范围获取</span></span><br><span class="line">    List&lt;String&gt; mylist2 = jedis.lrange(<span class="string">"mylist"</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">    System.out.println(mylist2);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//3. 关闭连接</span></span><br><span class="line">    jedis.close();</span><br></pre></td></tr></table></figure>

<h4 id="集合类型-set-1"><a href="#集合类型-set-1" class="headerlink" title="集合类型 set"></a>集合类型 <code>set</code></h4><p>不允许重复元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//sadd</span></span><br><span class="line"><span class="comment">//smembers:获取所有元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1. 获取连接</span></span><br><span class="line">    Jedis jedis = <span class="keyword">new</span> Jedis();<span class="comment">//如果使用空参构造,默认值 "localhost",6379端口</span></span><br><span class="line">    <span class="comment">//2. 操作</span></span><br><span class="line">       <span class="comment">// set 存储</span></span><br><span class="line">   jedis.sadd(<span class="string">"myset"</span>,<span class="string">"java"</span>,<span class="string">"php"</span>,<span class="string">"c++"</span>);</span><br><span class="line">   </span><br><span class="line">     <span class="comment">// set 获取</span></span><br><span class="line">   Set&lt;String&gt; myset = jedis.smembers(<span class="string">"myset"</span>);</span><br><span class="line">   System.out.println(myset);</span><br><span class="line">   </span><br><span class="line">     <span class="comment">//3. 关闭连接</span></span><br><span class="line">   jedis.close();</span><br></pre></td></tr></table></figure>

<h4 id="有序集合类型-sortedset-1"><a href="#有序集合类型-sortedset-1" class="headerlink" title="有序集合类型 sortedset"></a>有序集合类型 sortedset</h4><p>不允许重复元素,且元素有顺序</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//zadd</span></span><br><span class="line"><span class="comment">//zrange</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//1. 获取连接</span></span><br><span class="line">    Jedis jedis = <span class="keyword">new</span> Jedis();<span class="comment">//如果使用空参构造,默认值 "localhost",6379端口</span></span><br><span class="line">    <span class="comment">//2. 操作</span></span><br><span class="line">    <span class="comment">// sortedset 存储</span></span><br><span class="line">    jedis.zadd(<span class="string">"mysortedset"</span>,<span class="number">3</span>,<span class="string">"亚瑟"</span>);</span><br><span class="line">    jedis.zadd(<span class="string">"mysortedset"</span>,<span class="number">30</span>,<span class="string">"后裔"</span>);</span><br><span class="line">    jedis.zadd(<span class="string">"mysortedset"</span>,<span class="number">55</span>,<span class="string">"孙悟空"</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// sortedset 获取</span></span><br><span class="line">    Set&lt;String&gt; mysortedset = jedis.zrange(<span class="string">"mysortedset"</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">  </span><br><span class="line">    System.out.println(mysortedset);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//3. 关闭连接</span></span><br><span class="line">    jedis.close();</span><br></pre></td></tr></table></figure>

<h3 id="jedis连接池-JedisPool"><a href="#jedis连接池-JedisPool" class="headerlink" title="jedis连接池: JedisPool"></a>jedis连接池: <code>JedisPool</code></h3><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><ol>
<li><p>创建JedisPool连接池对象</p>
</li>
<li><p>调用方法 getResource()方法获取Jedis连接</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//0.创建一个配置对象</span></span><br><span class="line">JedisPoolConfig config = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">config.setMaxTotal(<span class="number">50</span>);</span><br><span class="line">config.setMaxIdle(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.创建Jedis连接池对象</span></span><br><span class="line">JedisPool jedisPool = <span class="keyword">new</span> JedisPool(config,<span class="string">"localhost"</span>,<span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.获取连接</span></span><br><span class="line">Jedis jedis = jedisPool.getResource();</span><br><span class="line"><span class="comment">//3. 使用</span></span><br><span class="line">jedis.set(<span class="string">"hehe"</span>,<span class="string">"heihei"</span>);</span><br><span class="line"> <span class="comment">//4. 关闭 归还到连接池中</span></span><br><span class="line"> jedis.close();</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="连接池工具类"><a href="#连接池工具类" class="headerlink" title="连接池工具类"></a>连接池工具类</h4>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisPoolUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span>&#123;</span><br><span class="line">            <span class="comment">//读取配置文件</span></span><br><span class="line">            InputStream is = JedisPoolUtils.class.getClassLoader().getResourceAsStream("jedis.properties");</span><br><span class="line">            <span class="comment">//创建Properties对象</span></span><br><span class="line">            Properties pro = <span class="keyword">new</span> Properties();</span><br><span class="line">            <span class="comment">//关联文件</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                pro.load(is);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//获取数据,设置到JedisPoolConfig中</span></span><br><span class="line">            JedisPoolConfig config = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">            config.setMaxTotal(Integer.parseInt(pro.getProperty(<span class="string">"maxTotal"</span>)));</span><br><span class="line">            config.setMaxIdle(Integer.parseInt(pro.getProperty(<span class="string">"maxIdle"</span>)));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//初始化JedisPool</span></span><br><span class="line">            jedisPool = <span class="keyword">new</span> JedisPool(config,pro.getProperty(<span class="string">"host"</span>),Integer.parseInt(pro.getProperty(<span class="string">"port"</span>)));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 获取连接方法</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Jedis <span class="title">getJedis</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> jedisPool.getResource();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><span id=spring-data-Redis></span></p>
<h1 id="Redis整合"><a href="#Redis整合" class="headerlink" title="Redis整合"></a>Redis整合</h1><h2 id="Spring整合Redis"><a href="#Spring整合Redis" class="headerlink" title="Spring整合Redis"></a>Spring整合Redis</h2><h3 id="普通整合"><a href="#普通整合" class="headerlink" title="普通整合"></a>普通整合</h3><h4 id="版本依赖"><a href="#版本依赖" class="headerlink" title="版本依赖"></a>版本依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"poolConfig"</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPoolConfig"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--最大空闲数--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"50"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--最大连接数--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxTotal"</span> <span class="attr">value</span>=<span class="string">"100"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--最大等待时间--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWaitMillis"</span> <span class="attr">value</span>=<span class="string">"20000"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--引入配置文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"redis.properties"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置spring连接工厂--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"connectionFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.connection.jedis.JedisConnectionFactory"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hostName"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.host&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"port"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.port&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"poolConfig"</span> <span class="attr">ref</span>=<span class="string">"poolConfig"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置 Spring RedisTemplate --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdkSerializationRedisSerializer"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.JdkSerializationRedisSerializer"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"stringRedisSerializer"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.StringRedisSerializer"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"redisTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.core.RedisTemplate"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"keySerializer"</span> <span class="attr">ref</span>=<span class="string">"stringRedisSerializer"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"valueSerializer"</span> <span class="attr">ref</span>=<span class="string">"jdkSerializationRedisSerializer"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSaveSameConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Role role = <span class="keyword">new</span> Role();</span><br><span class="line">    role.setId(<span class="number">1L</span>);</span><br><span class="line">    role.setRoleName(<span class="string">"redis-role-name-1"</span>);</span><br><span class="line">    role.setNote(<span class="string">"redis-role-note-1"</span>);</span><br><span class="line">    <span class="comment">//保证存和取来自同一个连接</span></span><br><span class="line">    SessionCallback callback = <span class="keyword">new</span> SessionCallback() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">execute</span><span class="params">(RedisOperations redisOperations)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">            redisOperations.boundValueOps(<span class="string">"ssm:redis:test:role-1"</span>).set(role);</span><br><span class="line">            <span class="keyword">return</span> redisOperations.boundValueOps(<span class="string">"ssm:redis:test:role-1"</span>).get();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    Role savedRole = (Role) redisTemplate.execute(callback);</span><br><span class="line">    log.info(savedRole.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Redis的发布订阅模式"><a href="#Redis的发布订阅模式" class="headerlink" title="Redis的发布订阅模式"></a>Redis的发布订阅模式</h3><h4 id="xml配置"><a href="#xml配置" class="headerlink" title="xml配置"></a>xml配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"redisTemplateValueWithString"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.core.RedisTemplate"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultSerializer"</span> <span class="attr">ref</span>=<span class="string">"stringRedisSerializer"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"keySerializer"</span> <span class="attr">ref</span>=<span class="string">"stringRedisSerializer"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--测试发布订阅模式时，需要用string序列化器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"valueSerializer"</span> <span class="attr">ref</span>=<span class="string">"stringRedisSerializer"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--注册接受消息的类--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"redisMsgListener"</span> <span class="attr">class</span>=<span class="string">"com.tang.ssm.redis.listener.RedisMessageListener"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"redisTemplate"</span> <span class="attr">ref</span>=<span class="string">"redisTemplateValueWithString"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--监听容器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"topicContainer"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.listener.RedisMessageListenerContainer"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">destroy-method</span>=<span class="string">"destroy"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--连接池，需要线程池生存，才能继续监听--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"taskExecutor"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"poolSize"</span> <span class="attr">value</span>=<span class="string">"3"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--消息监听Map--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageListeners"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置监听者--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key-ref</span>=<span class="string">"redisMsgListener"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--监听类--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.listener.ChannelTopic"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"chat"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="接受消息的类"><a href="#接受消息的类" class="headerlink" title="接受消息的类"></a>接受消息的类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * redis的发布订阅模式</span></span><br><span class="line"><span class="comment"> * 接受消息的类</span></span><br><span class="line"><span class="comment"> * 该类在xml中注册，用的时set方法注册</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisMessageListener</span> <span class="keyword">implements</span> <span class="title">MessageListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplateValueWithString;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate <span class="title">getRedisTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplateValueWithString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRedisTemplate</span><span class="params">(RedisTemplate redisTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisTemplateValueWithString = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message, <span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//接受消息</span></span><br><span class="line">        <span class="keyword">byte</span>[] body = message.getBody();</span><br><span class="line">        <span class="comment">//使用值序列化器转换</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String msgBody = (String) getRedisTemplate().getValueSerializer()</span><br><span class="line">                    .deserialize(body);</span><br><span class="line">            log.info(msgBody);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//log.info(msgBody);</span></span><br><span class="line">        <span class="comment">//获取channel</span></span><br><span class="line">        <span class="keyword">byte</span>[] channel = message.getChannel();</span><br><span class="line">        <span class="comment">//使用字符串序列化器转换</span></span><br><span class="line">        String channelStr = (String) getRedisTemplate().getStringSerializer()</span><br><span class="line">                .deserialize(channel);</span><br><span class="line">        log.info(channelStr);</span><br><span class="line">        <span class="comment">//渠道名称转换</span></span><br><span class="line">        String byteStr = <span class="keyword">new</span> String(bytes);</span><br><span class="line">        log.info(byteStr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">ContextConfiguration</span>(<span class="title">locations</span> </span>= &#123;<span class="string">"classpath:applicationContext_redis.xml"</span>&#125;)</span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisTemplateTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 涉及到发布订阅模式时，需要用到String序列化器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"redisTemplateValueWithString"</span>)</span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplateValueWithString;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPublishTopic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String channel = <span class="string">"chat"</span>;</span><br><span class="line">        String message = <span class="string">"redis publish!!"</span>;</span><br><span class="line">        redisTemplateValueWithString.convertAndSend(channel, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Spring整合redis缓存"><a href="#Spring整合redis缓存" class="headerlink" title="Spring整合redis缓存"></a>Spring整合redis缓存</h3><h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li>整合Spring和MyBatis</li>
<li>配置redisTemplate(连接池，序列化器配置，参考#普通整合)</li>
<li>配置redis的缓存管理器，设置超时时间，reids缓存名字，方便service层绑定，启用spring缓存</li>
<li>缓存注解解释<ol>
<li><strong>@Cacheable</strong>定义缓存策略 当缓存中有值，则返回缓存数据，否则访问方法得到数据 通过value引用缓存管理器，通过key定义键</li>
<li><strong>@CachePut</strong>则表示无论如何都会执行方法，最后将方法的返回值再保存到缓存中， 使用在插入数据的地方，则表示保存到数据库后，会同期插入到Redis缓存中。更新数据时，也会同时更新缓存</li>
<li><strong>@CacheEvict</strong>删除缓存对应的key</li>
</ol>
</li>
</ol>
<h4 id="Xml配置整合"><a href="#Xml配置整合" class="headerlink" title="Xml配置整合"></a>Xml配置整合</h4><h5 id="application-redis-xml"><a href="#application-redis-xml" class="headerlink" title="application_redis.xml"></a>application_redis.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--redis版xml--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--省略连接池，redisTemplate配置--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--启用缓存 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cache:annotation-driven</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--注册redis缓存--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"cacheManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.cache.RedisCacheManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"redisTemplateValueWithJdk"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--设置超时时间为10分钟，单位为秒--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultExpiration"</span> <span class="attr">value</span>=<span class="string">"60"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cacheNames"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>redisCacheManager<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="application-jdbc-xml"><a href="#application-jdbc-xml" class="headerlink" title="application_jdbc.xml"></a>application_jdbc.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">&lt;!--jdbc版xml--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--启用扫描机制，并指定扫描对应的包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.tang.ssm.redis.service"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--从配置文件读取 数据库连接参数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:db.properties"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1.将连接池放入spring容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.zaxxer.hikari.HikariDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.jdbcUrl&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driverClass&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.user&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 等待连接池分配连接的最大时长（毫秒），超过这个时长还没可用的连接则发生SQLException， 缺省:30秒 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionTimeout"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.connectionTimeout&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 一个连接idle状态的最大时长（毫秒），超时则被释放（retired），缺省:10分钟 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"idleTimeout"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.idleTimeout&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 一个连接的生命时长（毫秒），超时而且没被使用则被释放（retired），缺省:30分钟，建议设置比数据库超时时长少30秒，参考MySQL</span></span><br><span class="line"><span class="comment">            wait_timeout参数（show variables like '%timeout%';） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxLifetime"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.maxLifetime&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 连接池中允许的最大连接数。缺省值：10；推荐的公式：((core_count * 2) + effective_spindle_count) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maximumPoolSize"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.maximumPoolSize&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minimumIdle"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.minimumIdle&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 集成MyBatis --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定MyBatis配置文件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:/mybatis/mybatis-config.xml"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeAliasesPackage"</span> <span class="attr">value</span>=<span class="string">"com.tang.ssm.redis.pojo"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 事务管理器配置数据源事务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 使用注解定义事务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 采用自动扫描方式创建mapper bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.tang.ssm.redis.dao"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactoryBeanName"</span> <span class="attr">value</span>=<span class="string">"sqlSessionFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"annotationClass"</span> <span class="attr">value</span>=<span class="string">"org.springframework.stereotype.Repository"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Java注解配置"><a href="#Java注解配置" class="headerlink" title="Java注解配置"></a>Java注解配置</h4><h5 id="RedisConfig"><a href="#RedisConfig" class="headerlink" title="RedisConfig"></a>RedisConfig</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.tang.ssm.redis"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"redisTemplate"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate <span class="title">initRedisTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        JedisPoolConfig poolConfig = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">        <span class="comment">// 最大空闲数</span></span><br><span class="line">        poolConfig.setMaxIdle(<span class="number">50</span>);</span><br><span class="line">        <span class="comment">// 最大连接数</span></span><br><span class="line">        poolConfig.setMaxTotal(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">// 最大等待毫秒数</span></span><br><span class="line">        poolConfig.setMaxWaitMillis(<span class="number">20000</span>);</span><br><span class="line">        <span class="comment">// 创建Jedis连接工厂</span></span><br><span class="line">        JedisConnectionFactory connectionFactory = <span class="keyword">new</span> JedisConnectionFactory(poolConfig);</span><br><span class="line">        connectionFactory.setHostName(<span class="string">"localhost"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">6379</span>);</span><br><span class="line">        <span class="comment">// 调用后初始化方法，没有它将抛出异常</span></span><br><span class="line">        connectionFactory.afterPropertiesSet();</span><br><span class="line">        <span class="comment">// 自定Redis序列化器</span></span><br><span class="line">        RedisSerializer jdkSerializationRedisSerializer = <span class="keyword">new</span> JdkSerializationRedisSerializer();</span><br><span class="line">        RedisSerializer stringRedisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        <span class="comment">// 定义RedisTemplate，并设置连接工程</span></span><br><span class="line">        RedisTemplate redisTemplate = <span class="keyword">new</span> RedisTemplate();</span><br><span class="line">        redisTemplate.setConnectionFactory(connectionFactory);</span><br><span class="line">        <span class="comment">// 设置序列化器</span></span><br><span class="line">        redisTemplate.setDefaultSerializer(stringRedisSerializer);</span><br><span class="line">        redisTemplate.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        redisTemplate.setValueSerializer(jdkSerializationRedisSerializer);</span><br><span class="line">        redisTemplate.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        redisTemplate.setHashValueSerializer(jdkSerializationRedisSerializer);</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"redisCacheManager"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> CacheManager <span class="title">initRedisCacheManager</span><span class="params">(@Autowired RedisTemplate redisTemplate)</span> </span>&#123;</span><br><span class="line">        RedisCacheManager cacheManager = <span class="keyword">new</span> RedisCacheManager(redisTemplate);</span><br><span class="line">        <span class="comment">// 设置超时时间为10分钟，单位为秒</span></span><br><span class="line">        cacheManager.setDefaultExpiration(<span class="number">600</span>);</span><br><span class="line">        <span class="comment">// 设置缓存名称</span></span><br><span class="line">        List&lt;String&gt; cacheNames = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        cacheNames.add(<span class="string">"redisCacheManager"</span>);</span><br><span class="line">        cacheManager.setCacheNames(cacheNames);</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="JdbcConfig"><a href="#JdbcConfig" class="headerlink" title="JdbcConfig"></a>JdbcConfig</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.tang.ssm.redis"</span>)</span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcConfig</span> <span class="keyword">implements</span> <span class="title">TransactionManagementConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建一个数据源，并存入 spring 容器中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"dataSource"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">initDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (dataSource != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> dataSource;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            HikariDataSource dataSource = <span class="keyword">new</span> HikariDataSource();</span><br><span class="line">            <span class="comment">//todo 采取读取配置文件的方式一直失败</span></span><br><span class="line">            dataSource.setDriverClassName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">            dataSource.setJdbcUrl(<span class="string">"jdbc:mysql://localhost:3306/ssm_learn?useUnicode=true&amp;useSSL=false&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai"</span>);</span><br><span class="line">            dataSource.setUsername(<span class="string">"root"</span>);</span><br><span class="line">            dataSource.setPassword(<span class="string">"root123"</span>);</span><br><span class="line">            <span class="keyword">return</span> dataSource;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * * 配置SqlSessionFactoryBean</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> SqlSessionFactoryBean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"sqlSessionFactory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactoryBean <span class="title">initSqlSessionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SqlSessionFactoryBean sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">        sqlSessionFactory.setDataSource(initDataSource());</span><br><span class="line">        <span class="comment">// 配置MyBatis配置文件</span></span><br><span class="line">        Resource resource = <span class="keyword">new</span> ClassPathResource(<span class="string">"mybatis/mybatis-config.xml"</span>);</span><br><span class="line">        sqlSessionFactory.setConfigLocation(resource);</span><br><span class="line">        sqlSessionFactory.setTypeAliasesPackage(<span class="string">"com.tang.ssm.redis.pojo"</span>);</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * * 通过自动扫描，发现MyBatis Mapper接口</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Mapper扫描器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"mapperScannerConfigurer"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> MapperScannerConfigurer <span class="title">initMapperScannerConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MapperScannerConfigurer msc = <span class="keyword">new</span> MapperScannerConfigurer();</span><br><span class="line">        <span class="comment">// 扫描包</span></span><br><span class="line">        msc.setBasePackage(<span class="string">"com.tang.ssm.redis.dao"</span>);</span><br><span class="line">        msc.setSqlSessionFactoryBeanName(<span class="string">"sqlSessionFactory"</span>);</span><br><span class="line">        <span class="comment">// 区分注解扫描</span></span><br><span class="line">        msc.setAnnotationClass(Repository<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="keyword">return</span> msc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 实现接口方法，注册注解事务，当<span class="doctag">@Transactional</span> 使用的时候产生数据库事务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"annotationDrivenTransactionManager"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">annotationDrivenTransactionManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DataSourceTransactionManager transactionManager = <span class="keyword">new</span> DataSourceTransactionManager();</span><br><span class="line">        transactionManager.setDataSource(initDataSource());</span><br><span class="line">        <span class="keyword">return</span> transactionManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Serice层缓存注解配置"><a href="#Serice层缓存注解配置" class="headerlink" title="Serice层缓存注解配置"></a>Serice层缓存注解配置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoleServiceImpl</span> <span class="keyword">implements</span> <span class="title">RoleService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RoleDao roleDao = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用<span class="doctag">@Cacheable</span>定义缓存策略 当缓存中有值，则返回缓存数据，否则访问方法得到数据 通过value引用缓存管理器，通过key定义键</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 角色编号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 角色</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span>(isolation = Isolation.READ_COMMITTED, propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="meta">@Cacheable</span>(value = <span class="string">"redisCacheManager"</span>, key = <span class="string">"'ssm:redis:redis_role_'+#id"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Role <span class="title">getRole</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleDao.getRole(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用<span class="doctag">@CachePut</span>则表示无论如何都会执行方法，最后将方法的返回值再保存到缓存中</span></span><br><span class="line"><span class="comment">     * 使用在插入数据的地方，则表示保存到数据库后，会同期插入到Redis缓存中</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> role 角色对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 角色对象（会回填主键）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span>(isolation = Isolation.READ_COMMITTED, propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="meta">@CachePut</span>(value = <span class="string">"redisCacheManager"</span>, key = <span class="string">"'ssm:redis:redis_role_'+#result.id"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Role <span class="title">insertRole</span><span class="params">(Role role)</span> </span>&#123;</span><br><span class="line">        roleDao.insertRole(role);</span><br><span class="line">        <span class="keyword">return</span> role;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用<span class="doctag">@CachePut</span>，表示更新数据库数据的同时，也会同步更新缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> role 角色对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 影响条数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span>(isolation = Isolation.READ_COMMITTED, propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="meta">@CachePut</span>(value = <span class="string">"redisCacheManager"</span>, key = <span class="string">"'ssm:redis:redis_role_'+#role.id"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateRole</span><span class="params">(Role role)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleDao.updateRole(role);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用<span class="doctag">@CacheEvict</span>删除缓存对应的key</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 角色编号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回删除记录数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span>(isolation = Isolation.READ_COMMITTED, propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="meta">@CacheEvict</span>(value = <span class="string">"redisCacheManager"</span>, key = <span class="string">"'ssm:redis:redis_role_'+#id"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteRole</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleDao.deleteRole(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span>(isolation = Isolation.READ_COMMITTED, propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Role&gt; <span class="title">findRoles</span><span class="params">(String roleName, String note)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleDao.findRoles(roleName, note);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span>(isolation = Isolation.READ_COMMITTED, propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertRoles</span><span class="params">(List&lt;Role&gt; roleList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Role role : roleList) &#123;</span><br><span class="line">            <span class="comment">//同一类的方法调用自己方法，产生自调用[插入：失效]问题</span></span><br><span class="line">            <span class="keyword">this</span>.insertRole(role);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> roleList.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SpringBoot整合Redis"><a href="#SpringBoot整合Redis" class="headerlink" title="SpringBoot整合Redis"></a>SpringBoot整合Redis</h2><p>Spring Data Redis提供了RedisTemplate工具类，里面封装了对Redis的5种数据结构的各种操作。</p>
<ul>
<li><p><code>RedisTemplate.opsForValue()</code>：操作字符串</p>
</li>
<li><p><code>RedisTemplate.opsForHash()</code> ：操作hash</p>
</li>
<li><p><code>RedisTemplate.opsForList()</code>：操作list</p>
</li>
<li><p><code>RedisTemplate.opsForSet()</code>：操作set</p>
</li>
<li><p><code>RedisTemplate.opsForZSet()</code>：操作zset</p>
</li>
</ul>
<p>其他的通用命令,如expire,可以通过<code>RedisTemplate.xx()</code>来直接调用</p>
<h3 id="普通整合-1"><a href="#普通整合-1" class="headerlink" title="普通整合"></a>普通整合</h3><h4 id="依赖配置"><a href="#依赖配置" class="headerlink" title="依赖配置"></a>依赖配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--不依赖redis的异步客户端--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--redis客户端驱动--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">2000</span> <span class="comment">#毫秒</span></span><br><span class="line">    <span class="attr">jedis:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="number">2000</span></span><br></pre></td></tr></table></figure>
<h4 id="测试类-1"><a href="#测试类-1" class="headerlink" title="测试类"></a>测试类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * redisTemplate 操作存储数据到redis中，key显示为乱码。</span></span><br><span class="line"><span class="comment"> * 默认的序列化器为 JdkSerializationRedisSerializer</span></span><br><span class="line"><span class="comment"> * 存储string类型的，使用StringRedisTemplate.但是不能存储对象</span></span><br><span class="line"><span class="comment"> * StringRedisTemplate的序列化器为StringRedisSerializer</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="meta">@SpringBootTest</span>(classes = MyRedisApplication<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">RunWith</span>(<span class="title">SpringRunner</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">Slf4j</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">RedisTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将默认的redisTemplate的序列化器设置为stringSerializer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initRedisTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RedisSerializer stringSerializer = redisTemplate.getStringSerializer();</span><br><span class="line">        redisTemplate.setKeySerializer(stringSerializer);</span><br><span class="line">        redisTemplate.setValueSerializer(stringSerializer);</span><br><span class="line">        redisTemplate.setHashValueSerializer(stringSerializer);</span><br><span class="line">        redisTemplate.setHashKeySerializer(stringSerializer);</span><br><span class="line">        log.info(<span class="string">"成功将"</span>+redisTemplate.getClass().getSimpleName()+<span class="string">"的序列化器设置为了String类型"</span>);</span><br><span class="line">        log.info(redisTemplate.getKeySerializer().toString());</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">"springboot:test:test:redis_string_key"</span>, <span class="string">"value1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStringAndHash</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stringRedisTemplate.opsForValue().set(<span class="string">"springboot:test:test:string_int_key"</span>, <span class="string">"1"</span>);</span><br><span class="line">        <span class="comment">//使用运算</span></span><br><span class="line">        stringRedisTemplate.opsForValue().increment(<span class="string">"springboot:test:test:string_int_key"</span>, <span class="number">1</span>);</span><br><span class="line">        String value = stringRedisTemplate.opsForValue().get(<span class="string">"springboot:test:test:string_int_key"</span>);</span><br><span class="line">        log.info(value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试操作列表（链表）可重复，顺序存取</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 插入两个列表,注意它们在链表的顺序</span></span><br><span class="line">        <span class="comment">// 链表从左到右顺序为 v10,v8,v6,v4,v2</span></span><br><span class="line">        stringRedisTemplate.opsForList().leftPushAll(</span><br><span class="line">                <span class="string">"springboot:test:list1"</span>, <span class="string">"v2"</span>, <span class="string">"v4"</span>, <span class="string">"v6"</span>, <span class="string">"v8"</span>, <span class="string">"v10"</span>);</span><br><span class="line">        <span class="comment">// 链表从左到右顺序为 v1,v2,v3,v4,v5,v6</span></span><br><span class="line">        stringRedisTemplate.opsForList().rightPushAll(</span><br><span class="line">                <span class="string">"springboot:test:list2"</span>, <span class="string">"v1"</span>, <span class="string">"v2"</span>, <span class="string">"v3"</span>, <span class="string">"v4"</span>, <span class="string">"v5"</span>, <span class="string">"v6"</span>);</span><br><span class="line">        <span class="comment">// 绑定 list2 链表操作</span></span><br><span class="line">        BoundListOperations listOps = stringRedisTemplate.boundListOps(<span class="string">"springboot:test:list2"</span>);</span><br><span class="line">        <span class="comment">// 从右边弹出一个成员</span></span><br><span class="line">        Object result1 = listOps.rightPop();</span><br><span class="line">        <span class="comment">// 获取定位元素，Redis 从 0 开始计算,这里值为 v2</span></span><br><span class="line">        Object result2 = listOps.index(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 从左边插入链表</span></span><br><span class="line">        listOps.leftPush(<span class="string">"v0"</span>);</span><br><span class="line">        <span class="comment">// 求链表长度</span></span><br><span class="line">        Long size = listOps.size();</span><br><span class="line">        <span class="comment">// 求链表下标区间成员，整个链表下标范围为 0 到 size-1，这里不取最后一个元素</span></span><br><span class="line">        List elements = listOps.range(<span class="number">0</span>, size-<span class="number">2</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试操作无序集合set，无序</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 请注意：这里 v1 重复两次，因为集合不允许重复，所以只是插入 5 个成员到集合中</span></span><br><span class="line">        stringRedisTemplate.opsForSet().add(<span class="string">"springboot:test:set1"</span>,</span><br><span class="line">                <span class="string">"v1"</span>,<span class="string">"v1"</span>,<span class="string">"v2"</span>,<span class="string">"v3"</span>,<span class="string">"v4"</span>,<span class="string">"v5"</span>);</span><br><span class="line">        stringRedisTemplate.opsForSet().add(<span class="string">"springboot:test:set2"</span>, <span class="string">"v2"</span>,<span class="string">"v4"</span>,<span class="string">"v6"</span>,<span class="string">"v8"</span>);</span><br><span class="line">        <span class="comment">// 绑定 set1 集合操作</span></span><br><span class="line">        BoundSetOperations setOps = stringRedisTemplate.boundSetOps(<span class="string">"springboot:test:set1"</span>);</span><br><span class="line">        <span class="comment">// 增加两个元素</span></span><br><span class="line">        setOps.add(<span class="string">"v6"</span>, <span class="string">"v7"</span>);</span><br><span class="line">        <span class="comment">// 删除两个元素</span></span><br><span class="line">        setOps.remove(<span class="string">"v1"</span>, <span class="string">"v7"</span>);</span><br><span class="line">        <span class="comment">// 返回所有元素</span></span><br><span class="line">        Set set1 = setOps.members();</span><br><span class="line">        <span class="comment">// 求成员数</span></span><br><span class="line">        Long size = setOps.size();</span><br><span class="line">        <span class="comment">// 求交集</span></span><br><span class="line">        Set inter = setOps.intersect(<span class="string">"springboot:test:set2"</span>);</span><br><span class="line">        <span class="comment">// 求交集，并且用新集合 inter 保存</span></span><br><span class="line">        setOps.intersectAndStore(<span class="string">"springboot:test:set2"</span>, <span class="string">"springboot:test:set:inter"</span>);</span><br><span class="line">        <span class="comment">// 求差集</span></span><br><span class="line">        Set diff = setOps.diff(<span class="string">"springboot:test:set2"</span>);</span><br><span class="line">        <span class="comment">// 求差集，并且用新集合 diff 保存</span></span><br><span class="line">        setOps.diffAndStore(<span class="string">"springboot:test:set2"</span>, <span class="string">"springboot:test:set:diff"</span>);</span><br><span class="line">        <span class="comment">// 求并集</span></span><br><span class="line">        Set union = setOps.union(<span class="string">"springboot:test:set2"</span>);</span><br><span class="line">        <span class="comment">// 求并集，并且用新集合 union 保存</span></span><br><span class="line">        setOps.unionAndStore(<span class="string">"springboot:test:set2"</span>, <span class="string">"springboot:test:set:union"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试操作有序的set，不可重复</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testZset</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Set&lt;ZSetOperations.TypedTuple&lt;String&gt;&gt; typedTupleSet = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=<span class="number">9</span>; i++) &#123;</span><br><span class="line">            <span class="comment">// 分数</span></span><br><span class="line">            <span class="keyword">double</span> score = i*<span class="number">0.1</span>;</span><br><span class="line">        <span class="comment">// 创建一个 TypedTuple 对象，存入值和分数</span></span><br><span class="line">            ZSetOperations.TypedTuple&lt;String&gt; typedTuple</span><br><span class="line">                    = <span class="keyword">new</span> DefaultTypedTuple&lt;&gt;(<span class="string">"value"</span> + i, score);</span><br><span class="line">            typedTupleSet.add(typedTuple);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 往有序集合插入元素</span></span><br><span class="line">        stringRedisTemplate.opsForZSet().add(<span class="string">"springboot:test:zset1"</span>, typedTupleSet);</span><br><span class="line">        <span class="comment">// 绑定 zset1 有序集合操作</span></span><br><span class="line">        BoundZSetOperations&lt;String, String&gt; zsetOps</span><br><span class="line">                = stringRedisTemplate.boundZSetOps(<span class="string">"springboot:test:zset1"</span>);</span><br><span class="line">        <span class="comment">// 增加一个元素</span></span><br><span class="line">        zsetOps.add(<span class="string">"value10"</span>, <span class="number">0.26</span>);</span><br><span class="line">        Set&lt;String&gt; setRange = zsetOps.range(<span class="number">1</span>, <span class="number">6</span>);</span><br><span class="line">        <span class="comment">// 按分数排序获取有序集合</span></span><br><span class="line">        Set&lt;String&gt; setScore = zsetOps.rangeByScore(<span class="number">0.2</span>, <span class="number">0.6</span>);</span><br><span class="line">        <span class="comment">// 定义值范围</span></span><br><span class="line">        RedisZSetCommands.Range range = <span class="keyword">new</span> RedisZSetCommands.Range();</span><br><span class="line">        range.gt(<span class="string">"value3"</span>);<span class="comment">// 大于 value3</span></span><br><span class="line">        <span class="comment">//range.gte("value3");// 大于等于 value3</span></span><br><span class="line">        <span class="comment">//range.lt("value8");// 小于 value8</span></span><br><span class="line">        <span class="comment">//range.lte("value8");// 小于等于 value8</span></span><br><span class="line">        <span class="comment">// 按值排序，请注意这个排序是按字符串排序</span></span><br><span class="line">        Set&lt;String&gt; setLex = zsetOps.rangeByLex(range);</span><br><span class="line">        <span class="comment">// 删除元素</span></span><br><span class="line">        zsetOps.remove(<span class="string">"value9"</span>, <span class="string">"value2"</span>);</span><br><span class="line">        <span class="comment">// 求分数</span></span><br><span class="line">        Double score = zsetOps.score(<span class="string">"value8"</span>);</span><br><span class="line">        <span class="comment">// 在下标区间下，按分数排序，同时返回 value 和 score</span></span><br><span class="line">        Set&lt;ZSetOperations.TypedTuple&lt;String&gt;&gt; rangeSet = zsetOps.rangeWithScores(<span class="number">1</span>, <span class="number">6</span>);</span><br><span class="line">        <span class="comment">// 在分数区间下，按分数排序，同时返回 value 和 score</span></span><br><span class="line">        Set&lt;ZSetOperations.TypedTuple&lt;String&gt;&gt; scoreSet = zsetOps.rangeByScoreWithScores(<span class="number">1</span>, <span class="number">6</span>);</span><br><span class="line">        <span class="comment">// 按从大到小排序</span></span><br><span class="line">        Set&lt;String&gt; reverseSet = zsetOps.reverseRange(<span class="number">2</span>, <span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Redis事务"><a href="#Redis事务" class="headerlink" title="Redis事务"></a>Redis事务</h3><p>命令组合为<strong>watch..multi..exec</strong></p>
<p><img src="https://gitee.com/tzcqupt/blog-image/raw/master/img/Redis%E4%BA%8B%E5%8A%A1.PNG" alt="Redis事务"></p>
<h4 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1. 如果程序执行期间，key1的值被修改过（断点调试），则key2和key3没有值</span></span><br><span class="line"><span class="comment">     * 2. 程序执行期间，若①处的代码执行，则程序会抛出异常，因为字符串不能+1，但是key2和key3有值。这是redis事务的特点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMulti</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    redisTemplate.opsForValue().set(<span class="string">"springboot:test:multi:key1"</span>, <span class="string">"value1"</span>);</span><br><span class="line">    List list = (List) redisTemplate.execute(<span class="keyword">new</span> SessionCallback&lt;Object&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">execute</span><span class="params">(RedisOperations operations)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">            <span class="comment">// 设置要监控 key1</span></span><br><span class="line">            operations.watch(<span class="string">"springboot:test:multi:key1"</span>);</span><br><span class="line">            <span class="comment">// 开启事务，在 exec 命令执行前，全部都只是进入队列</span></span><br><span class="line">            operations.multi();</span><br><span class="line">            operations.opsForValue().set(<span class="string">"springboot:test:multi:key2"</span>, <span class="string">"value2"</span>);</span><br><span class="line">            operations.opsForValue().increment(<span class="string">"springboot:test:multi:key1"</span>, <span class="number">1</span>);<span class="comment">// ①此处执行命令会抛出异常</span></span><br><span class="line">            <span class="comment">// 获取值将为 null，因为 redis 只是把命令放入队列</span></span><br><span class="line">            Object value2 = operations.opsForValue().get(<span class="string">"springboot:test:multi:key2"</span>);</span><br><span class="line">            log.info(<span class="string">"命令在队列，所以 value 为 null【"</span> + value2 + <span class="string">"】"</span>);</span><br><span class="line">            operations.opsForValue().set(<span class="string">"springboot:test:multi:key3"</span>, <span class="string">"value3"</span>);</span><br><span class="line">            Object value3 = operations.opsForValue().get(<span class="string">"springboot:test:multi:key3"</span>);</span><br><span class="line">            log.info(<span class="string">"命令在队列，所以 value 为 null【"</span> + value3 + <span class="string">"】"</span>);</span><br><span class="line">            <span class="comment">// 执行 exec 命令，将先判别 key1 是否在监控后被修改过，如果是则不执行事务，否则就执行事务</span></span><br><span class="line">            <span class="keyword">return</span> operations.exec();<span class="comment">// ②</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    log.info(list.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Redis发布订阅"><a href="#Redis发布订阅" class="headerlink" title="Redis发布订阅"></a>Redis发布订阅</h3><h4 id="Java代码配置"><a href="#Java代码配置" class="headerlink" title="Java代码配置"></a>Java代码配置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRedisApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MyRedisApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate = <span class="keyword">null</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisConnectionFactory redisConnectionFactory = <span class="keyword">null</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MessageListener redisMsgListener;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 任务池</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> ThreadPoolTaskScheduler taskScheduler = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建任务池，运行线程等待处理redis的消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ThreadPoolTaskScheduler <span class="title">initTaskScheduler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (taskScheduler != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> taskScheduler;</span><br><span class="line">        &#125;</span><br><span class="line">        taskScheduler = <span class="keyword">new</span> ThreadPoolTaskScheduler();</span><br><span class="line">        taskScheduler.setPoolSize(<span class="number">20</span>);</span><br><span class="line">        <span class="keyword">return</span> taskScheduler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义redis的消息监听容器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 监听容器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisMessageListenerContainer <span class="title">initRedisContainer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RedisMessageListenerContainer container</span><br><span class="line">                = <span class="keyword">new</span> RedisMessageListenerContainer();</span><br><span class="line">        <span class="comment">// Redis 连接工厂</span></span><br><span class="line">        container.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="comment">// 设置运行任务池</span></span><br><span class="line">        container.setTaskExecutor(initTaskScheduler());</span><br><span class="line">        <span class="comment">// 定义监听渠道，名称为 topic1</span></span><br><span class="line">        Topic topic = <span class="keyword">new</span> ChannelTopic(<span class="string">"springboot:redis:topic"</span>);</span><br><span class="line">        <span class="comment">// 使用监听器监听 Redis 的消息</span></span><br><span class="line">        container.addMessageListener(redisMsgListener, topic);</span><br><span class="line">        <span class="keyword">return</span> container;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="测试代码-1"><a href="#测试代码-1" class="headerlink" title="测试代码"></a>测试代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPublishMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//测试发布消息</span></span><br><span class="line">    redisTemplate.convertAndSend(</span><br><span class="line">        <span class="string">"springboot:redis:topic"</span>, <span class="string">"测试redis发布订阅模式"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">tzcqupt</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://github.com/tzcqupt/tzcqupt.github.io/2020/04/27/Redis-Simple-Learn/">https://github.com/tzcqupt/tzcqupt.github.io/2020/04/27/Redis-Simple-Learn/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://github.com/tzcqupt/tzcqupt.github.io">个人学习博客</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Redis/">Redis</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/04/27/MyBatis-Simple-Learn/"><i class="fa fa-chevron-left">  </i><span>MyBaits入门学习笔记</span></a></div><div class="next-post pull-right"><a href="/2020/04/27/Spring-Simple-Learn/"><span>Spring入门学习笔记</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2022 By tzcqupt</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">要想一天什么时候开始,而不是什么时候结束</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>